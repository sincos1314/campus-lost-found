# 校园失物招领系统（前后端一体说明）

> 说明：本 README 覆盖系统的全部功能（前端 + 后端），包含安装部署、功能清单、角色权限、接口及使用指南，便于快速上手与维护。

## 项目概览

- 系统定位：面向中国高校学生与教师的失物/拾物信息发布、查询与私信沟通平台
- 技术栈：
  - 前端：Vue 3、Element Plus、Vue Router、Axios、Vite
  - 后端：Flask、SQLAlchemy、JWT、Flask‑SocketIO（实时消息）、SQLite
  - 运行环境：Windows（建议），Node.js ≥ 18，Python ≥ 3.10

## 主要功能

### 账号与认证

- 学生/教师注册（教师自动获得“中级管理员”身份）
- 登录/退出、忘记密码（登录页支持密码重置）
- 个人中心：
  - 头像上传/修改（单次 ≤ 10MB）
  - 基本资料修改：邮箱、手机号、院系、年级（单选：大一/大二/大三/大四）、班级、学号、性别
  - 年级显示遵循时间规则自动升级/毕业
  - 管理员入口按钮（管理员可见）

### 物品发布与管理

- 发布失物/拾物信息（标题、描述、类型、物品类型、地点、联系人、电话、日期、图片）
- 列表筛选：类型、状态（进行中/已解决）、关键词、日期范围；服务端分页
- 详情页：基本信息、时间线（通知）、图片预览（支持放大缩小）
- 我的发布：
  - 标记已解决、删除
  - 修改已发布信息（可更换图片、可修改类型及所有字段）

### 私信与通知（实时）

- 私信列表、会话详情、文本/图片消息（消息图片支持预览）
- 已读指示、正在输入提示（Socket.IO 实时）
- 管理员标识：标题与列表旁展示“高级/中级/低级”标签
- 封禁规则：
  - 被封禁用户可以查看通知/私信记录、进入会话
  - 被封禁用户只能联系“封禁该用户的管理员”，不能联系其他用户
  - 其他用户可正常向被封禁用户发送消息
  - 封禁/解封均伴随系统通知

### 隐私与发布者历史

- 可见性设置：隐藏/部分隐藏/不隐藏；“其他人默认显示/隐藏”
- 名单管理（互斥）：允许查看与禁止查看不能同时勾选同一用户，支持全选/清空
- 发布者历史页面：遵循隐私规则访问（403 显示中文提示）

### 举报功能（含匿名）

- 物品详情页发起举报：类别（垃圾信息/骚扰或辱骂/虚假信息/其他）、严重级（低/中/高）、说明、证据图片、匿名举报选项
- 我的举报：列表（中文字段）、查看证据、修改举报（含更新证据图片）、撤回举报
  - 撤回后：举报信息锁定（不可修改），状态显示“举报已撤回”
- 管理员“举报”板块：
  - 中文显示与筛选（处理中/已解决/已拒绝/已撤回）
  - 列展示：被举报物品（可跳转详情）、举报用户（匿名则显示“此用户为匿名举报”）、被举报用户、证据图片预览
  - 处理操作：
    - 状态设置（撤回状态仅展示、不可手动设置）
    - 删除此失物/拾物信息（删除后向发布者发送通知，举报记录保留）
    - 封禁被举报用户、封禁举报用户（即时弹出中文提示，匿名时不显示用户名）

### 管理员与权限

- 管理员等级：高级/中级/低级（高唯一；中/低可多个）
- 权限说明：
  - 高级：基础查看、任命/解除中/低、封禁、创建/删除用户与物品、标记物品状态
  - 中级：基础查看、任命/解除低级、封禁、创建/删除用户与物品、标记物品状态（不可更改高级）
  - 低级：基础查看（系统已允许创建用户/物品，可按需要限制）
- 自操作限制：管理员不可封禁/任命/解除/删除自身；同级或更高级不可被封禁/删除
- 管理员界面：用户/物品/举报/统计，中文化展示与筛选分页，创建用户/物品对话框（字段与注册一致）

### 图片上传与访问

- 统一大小限制：单次 ≤ 10MB（头像、物品图片、私信图片、证据图片）
- 文件类型：png/jpg/jpeg/gif/webp/bmp
- 访问：图片接口需 token 或公开路径（如头像/物品图片），预览支持放大

## 安装与运行

### 后端（Flask）

1. 进入后端目录并创建/激活虚拟环境（Windows）：
   - `cd backend`
   - `venv\Scripts\activate`
2. 安装依赖：
   - `pip install -r requirements.txt`
3. 启动后端：
   - `python app.py`
4. 默认地址：`http://localhost:5000`

### 前端（Vite）

1. 进入前端目录：`cd frontend`
2. 安装依赖：`npm install`
3. 启动开发：`npm run dev`
4. 默认地址：`http://localhost:5173`

## 角色与流程

### 注册与登录

- 学生：填写院系/年级/班级/学号/性别
- 教师：填写工号，注册后自动成为中级管理员
- 忘记密码：登录页点击“忘记密码”进行重置

### 管理员设置（示例）

- 通过数据库将目标用户设置为高级管理员（唯一）：
  - `UPDATE user SET role='admin', admin_level='high' WHERE username='你的管理员用户名';`

## 关键页面与操作

### 个人中心

- 修改资料与头像、进入管理员界面（管理员可见）、隐私可见性设置与名单互斥选择

### 列表/详情

- 列表筛选与分页、详情页时间线与图片预览、数据导出（如有）

### 我的发布

- 修改、标记已解决、删除、图片更换/删除、类型切换（失物/拾物）

### 私信

- 文本/图片消息、已读/输入中、菜单删除/撤回、仅对封禁管理员可发消息（被封禁用户）

### 举报

- 发起举报（可匿名）→ 管理员列表处理 → 举报者可修改/撤回
- 撤回后状态：中文“举报已撤回”，管理员与用户侧均锁定不可更改

### 管理员界面

- 工具栏：关键词搜索、举报状态/物品状态筛选、刷新，创建用户/物品
- 用户表：角色/等级/封禁标记，封禁/解封、任命/解除、删除、详情
- 物品表：状态标记、删除、详情
- 举报表：中文字段、证据预览、被举报物品跳转、举报用户/被举报用户列、处理备注、删除物品/封禁按钮
- 统计：用户总数、物品总数、失物/拾物数量、已解决数量、未处理举报

## 安全与规则

- JWT 鉴权，拦截器在登录/注册路由上对 401/422 做特殊处理（不强制跳转）
- 图片资源访问需携带 token（消息图片等）或公开路径（头像/物品图片）
- 封禁用户限制：不可发布/修改/删除物品、不可向非封禁管理员发私信、不可修改资料与隐私

## 常见问题

- 主题与中文化：全站简体中文；状态、类别、严重级均中文化
- 图片失败/预览 “FAILED”：前端预览使用完整后端 URL；消息图片接口附带 token
- 预检（CORS）报错：后端统一全局预检与允许头，举报修改图片上传支持 `PUT/POST`

## 接口提示（示例）

- 认证：`/api/auth/*`
- 物品：`/api/items`（GET/POST/PUT/DELETE）、`/api/items/:id/image`（POST/DELETE）
- 私信：`/api/conversations`、`/api/conversation/:id`、`/api/conversations/:id/send-image`
- 举报：`/api/reports`（POST）、`/api/reports/:id`（PUT/POST）、`/api/my-reports`（GET）
- 管理员：`/api/admin/users|items|reports|stats` 以及相关子路由（封禁/删除/状态）

## 运行与测试建议

- 浏览器打开 `http://localhost:5173`，注册两个学生与一个教师（教师登录后进入管理员界面）
- 发布若干失物/拾物，测试筛选/分页/修改/图片更换
- 私信互发文本与图片，测试被封禁用户只可联系封禁管理员
- 测试隐私名单互斥、发布者历史访问 403 提示
- 在管理员界面处理举报：查看证据、删除物品/封禁用户、状态与备注更新、中文提示校验

## 目录结构（简略）

- `backend/`：Flask 应用、模型、接口、图片上传与预览、SocketIO
- `frontend/`：Vue 3 应用、视图与组件、路由与守卫、主题与中文化

---
